<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>سجل الحضور والإنصراف</title>

  <!-- Sentry Loader Script -->
  <script src="https://js-de.sentry-cdn.com/7b23924c66cbc434e36d765203ee6d55.min.js" crossorigin="anonymous"></script>
  <script>
      Sentry.onLoad(function() {
        Sentry.init({
            dsn: "https://7b23924c66cbc434e36d765203ee6d55@o4509758163451904.ingest.de.sentry.io/4509758170988624",
            release: "AttendanceApp@1.0.0", // تأكد من تحديث هذا عند النشر
            tracesSampleRate: 1.0,
            replaysSessionSampleRate: 0.1,
            replaysOnErrorSampleRate: 1.0,
          });
           // Sentry.setUser يمكن استدعاؤها في script.js بعد الحصول على userEmail
      });
    </script>

  <!-- Google Identity Services Script -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- *** FingerprintJS Open Source Loader Script (أضف هذا) *** -->
  <script>
    window.userFingerprint = 'getting'; // حالة أولية (يمكن تغييرها)

    // استخدم openfpcdn.io للمكتبة مفتوحة المصدر
    import('https://openfpcdn.io/fingerprintjs/v4')
      .then(FingerprintJS => {
        if (FingerprintJS && FingerprintJS.load) {
           FingerprintJS.load()
            .then(fp => fp.get())
            .then(result => {
              window.userFingerprint = result.visitorId;
              console.log("Fingerprint obtained via Loader Script:", window.userFingerprint);
            })
            .catch(error => {
              console.error("Error getting fingerprint via Loader Script:", error);
              window.userFingerprint = 'unavailable';
              if (typeof Sentry !== 'undefined' && Sentry.captureException) {
                   Sentry.captureException(error);
              }
            });
        } else {
             console.error("FingerprintJS library load failed via Loader Script.");
             window.userFingerprint = 'load_failed';
              if (typeof Sentry !== 'undefined' && Sentry.captureMessage) {
                   Sentry.captureMessage("FingerprintJS library load failed via Loader Script.");
              }
        }
      })
      .catch(error => {
           console.error("Failed to import FingerprintJS module via Loader Script:", error);
           window.userFingerprint = 'import_failed';
            if (typeof Sentry !== 'undefined' && Sentry.captureException) {
                 Sentry.captureException(error);
            }
      });
  </script>

  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <!-- كل المحتوى المرئي للصفحة -->

  <div id="status-message" class="hidden"></div>
  <div id="error-message" class="hidden"></div>

  <div id="g_id_signin"></div> <!-- زر جوجل -->

  <div id="form-fields" class="form-fields hidden"> <!-- حاوية النموذج -->
      <select id="username" required autocomplete="name">
        <option value="">-- اختر الاسم --</option>
        <option value="أحمد محمد">أحمد محمد</option>
        <option value="سارة عبدالله">سارة عبدالله</option>
        <option value="يوسف خالد">يوسف خالد</option>
      </select>
      <input type="tel" id="phone" placeholder="9715XXXXXXXX" required autocomplete="tel" />
      <small>مثال: 971501234567</small>
  </div>

  <div id="buttons-container" class="hidden"> <!-- حاوية الأزرار -->
      <button id="check-in">تسجيل الحضور</button>
      <button id="check-out">تسجيل الانصراف</button>
  </div>

  <!-- سكريبتك الرئيسي في نهاية body -->
  <script src="script.js"></script>

</body>
</html>
